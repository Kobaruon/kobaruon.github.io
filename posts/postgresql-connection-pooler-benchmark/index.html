<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>PostgreSQL Connection Pooler Benchmark | Random Scribbles</title><meta name=keywords content><meta name=description content="Hi everyone, I&rsquo;ve tested 3 different connection poolers from community projects.
 Pgbouncer Odyssey  Pgcat  Before I dive into test setup and test results, here is a quick rundown of their pros and cons.
Pgbouncer    Pros Cons     It has a proven track record Single threaded   Used and well known in the team Need to start new pgbouncer instance from different ports if you want to scale    Pgcat    Pros Cons     Multi threaded New project   Load balancing Beta version   Query routing Lacks authentication method support    Odyssey    Pros Cons     Used by Yandex and their cloud service by default Documentation is sometimes hard to navigate   Multi threaded    Can give database and user specific pool settings     Test setup"><meta name=author content="Alper"><link rel=canonical href=https://kobaruon.github.io/posts/postgresql-connection-pooler-benchmark/><link crossorigin=anonymous href=/assets/css/stylesheet.min.48a18943c2fc15c38a372b8dde1f5e5dc0bc64fa6cb90f5a817d2f8c76b7f3ae.css integrity="sha256-SKGJQ8L8FcOKNyuN3h9eXcC8ZPpsuQ9agX0vjHa3864=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://kobaruon.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://kobaruon.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://kobaruon.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://kobaruon.github.io/apple-touch-icon.png><link rel=mask-icon href=https://kobaruon.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8839212809742675" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9DYG4R416J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9DYG4R416J",{anonymize_ip:!1})}</script><meta property="og:title" content="PostgreSQL Connection Pooler Benchmark"><meta property="og:description" content="Hi everyone, I&rsquo;ve tested 3 different connection poolers from community projects.
 Pgbouncer Odyssey  Pgcat  Before I dive into test setup and test results, here is a quick rundown of their pros and cons.
Pgbouncer    Pros Cons     It has a proven track record Single threaded   Used and well known in the team Need to start new pgbouncer instance from different ports if you want to scale    Pgcat    Pros Cons     Multi threaded New project   Load balancing Beta version   Query routing Lacks authentication method support    Odyssey    Pros Cons     Used by Yandex and their cloud service by default Documentation is sometimes hard to navigate   Multi threaded    Can give database and user specific pool settings     Test setup"><meta property="og:type" content="article"><meta property="og:url" content="https://kobaruon.github.io/posts/postgresql-connection-pooler-benchmark/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-04-04T20:19:12+03:00"><meta property="article:modified_time" content="2022-04-04T20:19:12+03:00"><meta property="og:site_name" content="Random Scribbles"><meta name=twitter:card content="summary"><meta name=twitter:title content="PostgreSQL Connection Pooler Benchmark"><meta name=twitter:description content="Hi everyone, I&rsquo;ve tested 3 different connection poolers from community projects.
 Pgbouncer Odyssey  Pgcat  Before I dive into test setup and test results, here is a quick rundown of their pros and cons.
Pgbouncer    Pros Cons     It has a proven track record Single threaded   Used and well known in the team Need to start new pgbouncer instance from different ports if you want to scale    Pgcat    Pros Cons     Multi threaded New project   Load balancing Beta version   Query routing Lacks authentication method support    Odyssey    Pros Cons     Used by Yandex and their cloud service by default Documentation is sometimes hard to navigate   Multi threaded    Can give database and user specific pool settings     Test setup"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://kobaruon.github.io/posts/"},{"@type":"ListItem","position":3,"name":"PostgreSQL Connection Pooler Benchmark","item":"https://kobaruon.github.io/posts/postgresql-connection-pooler-benchmark/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"PostgreSQL Connection Pooler Benchmark","name":"PostgreSQL Connection Pooler Benchmark","description":"Hi everyone, I\u0026rsquo;ve tested 3 different connection poolers from community projects.\n Pgbouncer Odyssey  Pgcat  Before I dive into test setup and test results, here is a quick rundown of their pros and cons.\nPgbouncer    Pros Cons     It has a proven track record Single threaded   Used and well known in the team Need to start new pgbouncer instance from different ports if you want to scale    Pgcat    Pros Cons     Multi threaded New project   Load balancing Beta version   Query routing Lacks authentication method support    Odyssey    Pros Cons     Used by Yandex and their cloud service by default Documentation is sometimes hard to navigate   Multi threaded    Can give database and user specific pool settings     Test setup","keywords":[],"articleBody":"Hi everyone, I’ve tested 3 different connection poolers from community projects.\n Pgbouncer Odyssey  Pgcat  Before I dive into test setup and test results, here is a quick rundown of their pros and cons.\nPgbouncer    Pros Cons     It has a proven track record Single threaded   Used and well known in the team Need to start new pgbouncer instance from different ports if you want to scale    Pgcat    Pros Cons     Multi threaded New project   Load balancing Beta version   Query routing Lacks authentication method support    Odyssey    Pros Cons     Used by Yandex and their cloud service by default Documentation is sometimes hard to navigate   Multi threaded    Can give database and user specific pool settings     Test setup\n 8 core CPU 16GB memory PostgreSQL 14.0 Pgbouncer 1.16.0 Pgcat 0.1.0 Odyssey 1.2  Dataset is initialized by a scale factor of 50. I did this because, by default pgbench creates a simple 16mb database. Scale factor 50 is not that much in terms of data size. It equals to 800mb and 5 million rows for pgbench_accounts table.\npgbench -i -s 50 test_db\nExample command\npgbench -T 60 -c 512 -j 2 -p 6437 -h 10.85.123.202 -U dba -S --protocol extended -v\nThere were mainly 6 different tests starting from 16 connections to 512 connections. I have tested the following scenarios.\n 16 connections 2 threads 32 connections 2 threads 64 connections 2 threads 128 connections 2 threads 256 connections 2 threads 512 connections 2 threads  Results In terms of TPS, Odyssey is a clear winner here. It performed more than 2x better than pgbouncer. Once we reach 512 connections, it starts to manage connections better than native PostgreSQL.\nIn terms of latency, again Odyssey performed better than other poolers. It even had lower latency than PostgreSQL once again after we reach 512 connections.\nAs a result of tests, in my opinion it was no surprise that Odyssey performed better than its competitors, because it can run on multiple threads and has a more modern architecture. Main problem with Pgbouncer is that it’s a really old project with only single core support. It causes multiple issues when it comes to scaling Pgbouncer, and adds complexity to your setup. On the other hand, Pgcat tries to solve this problem, and looks like it already performs better than Pgbouncer, but it’s still too early in development.\nReferences https://www.postgresql.org/docs/current/pgbench.html\n","wordCount":"386","inLanguage":"en","datePublished":"2022-04-04T20:19:12+03:00","dateModified":"2022-04-04T20:19:12+03:00","author":{"@type":"Person","name":"Alper"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://kobaruon.github.io/posts/postgresql-connection-pooler-benchmark/"},"publisher":{"@type":"Organization","name":"Random Scribbles","logo":{"@type":"ImageObject","url":"https://kobaruon.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kobaruon.github.io accesskey=h title="Random Scribbles (Alt + H)">Random Scribbles</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://kobaruon.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://kobaruon.github.io>Home</a>&nbsp;»&nbsp;<a href=https://kobaruon.github.io/posts/>Posts</a></div><h1 class=post-title>PostgreSQL Connection Pooler Benchmark</h1><div class=post-meta><span title="2022-04-04 20:19:12 +0300 +0300">4 April 2022</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Alper</div></header><div class=post-content><p>Hi everyone, I&rsquo;ve tested 3 different connection poolers from community projects.</p><ol><li><a href=https://github.com/pgbouncer/pgbouncer>Pgbouncer</a></li><li><a href=https://github.com/yandex/odyssey>Odyssey</a> </li><li><a href=https://github.com/levkk/pgcat>Pgcat</a></li></ol><p>Before I dive into test setup and test results, here is a quick rundown of their pros and cons.</p><h3 id=pgbouncer>Pgbouncer<a hidden class=anchor aria-hidden=true href=#pgbouncer>#</a></h3><table><thead><tr><th>Pros</th><th>Cons</th></tr></thead><tbody><tr><td>It has a proven track record</td><td>Single threaded</td></tr><tr><td>Used and well known in the team</td><td>Need to start new pgbouncer instance from different ports if you want to scale</td></tr></tbody></table><h3 id=pgcat>Pgcat<a hidden class=anchor aria-hidden=true href=#pgcat>#</a></h3><table><thead><tr><th>Pros</th><th>Cons</th></tr></thead><tbody><tr><td>Multi threaded</td><td>New project</td></tr><tr><td>Load balancing</td><td>Beta version</td></tr><tr><td>Query routing</td><td>Lacks authentication method support</td></tr></tbody></table><h3 id=odyssey>Odyssey<a hidden class=anchor aria-hidden=true href=#odyssey>#</a></h3><table><thead><tr><th>Pros</th><th>Cons</th></tr></thead><tbody><tr><td>Used by Yandex and their cloud service by default</td><td>Documentation is sometimes hard to navigate</td></tr><tr><td>Multi threaded</td><td></td></tr><tr><td>Can give database and user specific pool settings</td><td></td></tr></tbody></table><p>Test setup</p><ul><li>8 core CPU</li><li>16GB memory</li><li>PostgreSQL 14.0</li><li>Pgbouncer 1.16.0</li><li>Pgcat 0.1.0</li><li>Odyssey 1.2</li></ul><p>Dataset is initialized by a scale factor of 50. I did this because, by default pgbench creates a simple 16mb database. Scale factor 50 is not that much in terms of data size. It equals to 800mb and 5 million rows for <strong>pgbench_accounts</strong> table.</p><p><code>pgbench -i -s 50 test_db</code></p><p>Example command</p><p><code>pgbench -T 60 -c 512 -j 2 -p 6437 -h 10.85.123.202 -U dba -S --protocol extended -v</code></p><p>There were mainly 6 different tests starting from 16 connections to 512 connections. I have tested the following scenarios.</p><ul><li>16 connections 2 threads</li><li>32 connections 2 threads</li><li>64 connections 2 threads</li><li>128 connections 2 threads</li><li>256 connections 2 threads</li><li>512 connections 2 threads</li></ul><h3 id=results>Results<a hidden class=anchor aria-hidden=true href=#results>#</a></h3><p>In terms of TPS, Odyssey is a clear winner here. It performed more than 2x better than pgbouncer. Once we reach 512 connections, it starts to manage connections better than native PostgreSQL.</p><p><img loading=lazy src=/tpscp10.png alt=Image>
<img loading=lazy src=/tpscp100.png alt=Image></p><p>In terms of latency, again Odyssey performed better than other poolers. It even had lower latency than PostgreSQL once again after we reach 512 connections.</p><p><img loading=lazy src=/latencycp10.png alt=Image>
<img loading=lazy src=/latencycp100.png alt=Image></p><p>As a result of tests, in my opinion it was no surprise that Odyssey performed better than its competitors, because it can run on multiple threads and has a more modern architecture. Main problem with Pgbouncer is that it&rsquo;s a really old project with only single core support. It causes multiple issues when it comes to scaling Pgbouncer, and adds complexity to your setup. On the other hand, Pgcat tries to solve this problem, and looks like it already performs better than Pgbouncer, but it&rsquo;s still too early in development.</p><h3 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h3><p><a href=https://www.postgresql.org/docs/current/pgbench.html>https://www.postgresql.org/docs/current/pgbench.html</a></p></div><footer class=post-footer><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share PostgreSQL Connection Pooler Benchmark on twitter" href="https://twitter.com/intent/tweet/?text=PostgreSQL%20Connection%20Pooler%20Benchmark&url=https%3a%2f%2fkobaruon.github.io%2fposts%2fpostgresql-connection-pooler-benchmark%2f&hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share PostgreSQL Connection Pooler Benchmark on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fkobaruon.github.io%2fposts%2fpostgresql-connection-pooler-benchmark%2f&title=PostgreSQL%20Connection%20Pooler%20Benchmark&summary=PostgreSQL%20Connection%20Pooler%20Benchmark&source=https%3a%2f%2fkobaruon.github.io%2fposts%2fpostgresql-connection-pooler-benchmark%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://kobaruon.github.io>Random Scribbles</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerText="copy";function s(){e.innerText="copied!",setTimeout(()=>{e.innerText="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>